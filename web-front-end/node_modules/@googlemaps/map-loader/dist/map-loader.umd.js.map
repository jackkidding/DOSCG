{"version":3,"file":"map-loader.umd.js","sources":["../node_modules/@googlemaps/loader/dist/loader.esm.js","../src/map-loader.ts"],"sourcesContent":["/**\r\n * Copyright 2019 Google LLC. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/// <reference types=\"@types/googlemaps\" />\r\nclass Loader {\r\n    constructor({ apiKey, libraries = [], channel, language, clientId, region, version }) {\r\n        this.CALLBACK = \"__google_maps_callback\";\r\n        this.URL = \"https://maps.googleapis.com/maps/api/js\";\r\n        this.callbacks = [];\r\n        this.done = false;\r\n        this.loading = false;\r\n        this.version = version;\r\n        this.apiKey = apiKey;\r\n        this.libraries = libraries;\r\n        this.channel = channel;\r\n        this.language = language;\r\n        this.clientId = clientId;\r\n        this.region = region;\r\n    }\r\n    createUrl() {\r\n        let url = this.URL;\r\n        url += \"?callback=\" + this.CALLBACK;\r\n        if (this.apiKey) {\r\n            url += \"&key=\" + this.apiKey;\r\n        }\r\n        if (this.libraries.length > 0) {\r\n            url += \"&libraries=\" + this.libraries.join(\",\");\r\n        }\r\n        if (this.clientId) {\r\n            url += \"&client=\" + this.clientId;\r\n        }\r\n        if (this.channel) {\r\n            url += \"&channel=\" + this.channel;\r\n        }\r\n        if (this.language) {\r\n            url += \"&language=\" + this.language;\r\n        }\r\n        if (this.region) {\r\n            url += \"&region=\" + this.region;\r\n        }\r\n        if (this.version) {\r\n            url += \"&v=\" + this.version;\r\n        }\r\n        return url;\r\n    }\r\n    load() {\r\n        return this.loadPromise();\r\n    }\r\n    loadPromise() {\r\n        return new Promise((resolve, reject) => {\r\n            this.loadCallback((err) => {\r\n                if (!err) {\r\n                    resolve();\r\n                }\r\n                else {\r\n                    reject(err);\r\n                }\r\n            });\r\n        });\r\n    }\r\n    loadCallback(fn) {\r\n        this.callbacks.push(fn);\r\n        this.execute();\r\n    }\r\n    setScript() {\r\n        const url = this.createUrl();\r\n        const script = document.createElement(\"script\");\r\n        script.type = \"text/javascript\";\r\n        script.src = url;\r\n        script.onerror = this.loadErrorCallback;\r\n        script.defer = true;\r\n        script.async = true;\r\n        document.head.appendChild(script);\r\n    }\r\n    loadErrorCallback(e) {\r\n        this.onerrorEvent = e;\r\n        this.callback();\r\n    }\r\n    setCallback() {\r\n        window[this.CALLBACK] = this.callback.bind(this);\r\n    }\r\n    callback() {\r\n        this.done = true;\r\n        this.loading = false;\r\n        this.callbacks.forEach(cb => {\r\n            cb(this.onerrorEvent);\r\n        });\r\n        this.callbacks = [];\r\n    }\r\n    execute() {\r\n        if (this.done) {\r\n            this.callback();\r\n        }\r\n        else {\r\n            if (this.loading) ;\r\n            else {\r\n                this.loading = true;\r\n                this.setCallback();\r\n                this.setScript();\r\n            }\r\n        }\r\n    }\r\n}\n\nexport { Loader };\n//# sourceMappingURL=loader.esm.js.map\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {Loader, LoaderOptions} from '@googlemaps/loader';\n\nexport interface MapLoaderOptions {\n  apiKey: string;\n  divId: string;\n  mapOptions: google.maps.MapOptions;\n  apiOptions?: MapsJSAPIOptions;\n  append?: boolean;\n}\n\nexport type MapsJSAPIOptions = Omit<LoaderOptions, 'apiKey'>;\n\nexport class GoogleMap {\n  async initMap(options: MapLoaderOptions): Promise<google.maps.Map<Element>> {\n    await this.loadJSAPI(options);\n    const mapDiv: Element = this.getMapDiv(options);\n    // Initialize the map\n    const map = new google.maps.Map(mapDiv, options.mapOptions);\n    return map;\n  }\n\n  private getMapDiv(options: MapLoaderOptions): Element {\n    // Get the div to load the map into\n    let mapDiv: Element = document.getElementById(options.divId);\n    if (options.append) {\n      mapDiv = this.appendMapDiv(mapDiv);\n    }\n    return mapDiv;\n  }\n\n  private appendMapDiv(mapDiv: Element): Element {\n    const appendDivId = 'google_map_appended';\n    const appendDiv: Element = document.createElement('div');\n    appendDiv.setAttribute('id', appendDivId);\n    mapDiv.appendChild(appendDiv);\n    return appendDiv;\n  }\n\n  private async loadJSAPI(options: MapLoaderOptions): Promise<void> {\n    if (!options.apiOptions) {\n      options.apiOptions = {};\n    }\n    const loaderOptions: LoaderOptions =\n      Object.assign(options.apiOptions, {apiKey: options.apiKey});\n\n    const loader: Loader = new Loader(loaderOptions);\n    // Load the Maps JS API\n    return loader.load();\n  }\n}\n"],"names":["Loader","[object Object]","apiKey","libraries","channel","language","clientId","region","version","CALLBACK","URL","callbacks","done","loading","url","this","length","join","loadPromise","Promise","resolve","reject","loadCallback","err","fn","push","execute","createUrl","script","document","createElement","type","src","onerror","loadErrorCallback","defer","async","head","appendChild","e","onerrorEvent","callback","window","bind","forEach","cb","setCallback","setScript","GoogleMap","options","loadJSAPI","_a","mapDiv","getMapDiv","google","maps","Map","mapOptions","getElementById","divId","append","appendMapDiv","appendDiv","setAttribute","apiOptions","loaderOptions","Object","assign","load"],"mappings":"qnDA6BA,MAAaA,EAgBXC,aAAYC,OACVA,EADUC,UAEVA,EAAY,GAFFC,QAGVA,EAHUC,SAIVA,EAJUC,SAKVA,EALUC,OAMVA,EANUC,QAOVA,SAdMC,SAAW,8BACXC,IAAM,+CACNC,UAAsC,QACtCC,MAAO,OACPC,SAAU,OAYXL,QAAUA,OACVN,OAASA,OACTC,UAAYA,OACZC,QAAUA,OACVC,SAAWA,OACXC,SAAWA,OACXC,OAASA,EAGTN,gBACDa,EAAMC,KAAKL,WAEfI,GAAO,aAAeC,KAAKN,SAEvBM,KAAKb,SACPY,GAAO,QAAUC,KAAKb,QAGpBa,KAAKZ,UAAUa,OAAS,IAC1BF,GAAO,cAAgBC,KAAKZ,UAAUc,KAAK,MAGzCF,KAAKT,WACPQ,GAAO,WAAaC,KAAKT,UAGvBS,KAAKX,UACPU,GAAO,YAAcC,KAAKX,SAGxBW,KAAKV,WACPS,GAAO,aAAeC,KAAKV,UAGzBU,KAAKR,SACPO,GAAO,WAAaC,KAAKR,QAGvBQ,KAAKP,UACPM,GAAO,MAAQC,KAAKP,SAGfM,EAGFb,cACEc,KAAKG,cAGPjB,qBACE,IAAIkB,QAAQ,CAACC,EAASC,UACtBC,aAAcC,IACZA,EAGHF,EAAOE,GAFPH,QAQDnB,aAAauB,QACbb,UAAUc,KAAKD,QACfE,UAGCzB,kBACAa,EAAMC,KAAKY,YACXC,EAASC,SAASC,cAAc,UAEtCF,EAAOG,KAAO,kBACdH,EAAOI,IAAMlB,EACbc,EAAOK,QAAUlB,KAAKmB,kBACtBN,EAAOO,OAAQ,EACfP,EAAOQ,OAAQ,EACfP,SAASQ,KAAKC,YAAYV,GAGpB3B,kBAAkBsC,QACnBC,aAAeD,OACfE,WAGCxC,cACLyC,OAAe3B,KAAKN,UAAYM,KAAK0B,SAASE,KAAK5B,MAG9Cd,gBACDW,MAAO,OACPC,SAAU,OAEVF,UAAUiC,QAAQC,IACrBA,EAAG9B,KAAKyB,qBAGL7B,UAAY,GAGXV,UACFc,KAAKH,UACF6B,WAED1B,KAAKF,eAGFA,SAAU,OACViC,mBACAC,oDCrILC,oBAAN,SAAcC,4GACNlC,KAAKmC,UAAUD,kBAArBE,SACMC,EAAkBrC,KAAKsC,UAAUJ,MAE3B,IAAIK,OAAOC,KAAKC,IAAIJ,EAAQH,EAAQQ,qBAI1CT,sBAAR,SAAkBC,OAEZG,EAAkBvB,SAAS6B,eAAeT,EAAQU,cAClDV,EAAQW,SACVR,EAASrC,KAAK8C,aAAaT,IAEtBA,GAGDJ,yBAAR,SAAqBI,OAEbU,EAAqBjC,SAASC,cAAc,cAClDgC,EAAUC,aAAa,KAFH,uBAGpBX,EAAOd,YAAYwB,GACZA,GAGKd,sBAAd,SAAwBC,mFACjBA,EAAQe,aACXf,EAAQe,WAAa,IAEjBC,EACJC,OAAOC,OAAOlB,EAAQe,WAAY,CAAC9D,OAAQ+C,EAAQ/C,YAE9B,IAAIF,EAAOiE,GAEpBG"}